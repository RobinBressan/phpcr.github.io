<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Tue, 27 Mar 2012 06:17:46 +0000">

<link rel="stylesheet" type="text/css" href="../../../stylesheet.css">
<link rel="start" href="../../../overview-summary.html">

<title>PHPCR/Lock/LockManagerInterface.php (PHPCR API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/lock/lockmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>PHPCR/Lock/LockManagerInterface.php</h1>
<div class="comment" id="overview_description"><p>This file is part of the PHPCR API and was originally ported from the Java
JCR API to PHP by Karsten Dambekalns for the FLOW3 project.</p><p>Copyright 2008-2011 Karsten Dambekalns <karsten@typo3.org></p><p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p><p>http://www.apache.org/licenses/LICENSE-2.0</p><p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div>

<hr>

<a name="line1"></a><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<a name="line2"></a>&nbsp;
<a name="line3"></a><span style="color: #009933; font-style: italic;">/**
<a name="line4"></a> * This file is part of the PHPCR API and was originally ported from the Java
<a name="line5"></a> * JCR API to PHP by Karsten Dambekalns for the FLOW3 project.
<a name="line6"></a> *
<a name="line7"></a> * Copyright 2008-2011 Karsten Dambekalns &lt;karsten@typo3.org&gt;
<a name="line8"></a> *
<a name="line9"></a> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<a name="line10"></a> * you may not use this file except in compliance with the License.
<a name="line11"></a> * You may obtain a copy of the License at
<a name="line12"></a> *
<a name="line13"></a> *     http://www.apache.org/licenses/LICENSE-2.0
<a name="line14"></a> *
<a name="line15"></a> * Unless required by applicable law or agreed to in writing, software
<a name="line16"></a> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<a name="line17"></a> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<a name="line18"></a> * See the License for the specific language governing permissions and
<a name="line19"></a> * limitations under the License.
<a name="line20"></a> *
<a name="line21"></a> * @license http://www.apache.org/licenses/LICENSE-2.0 Apache Software License 2.0
<a name="line22"></a> * @link http://phpcr.github.com/
<a name="line23"></a>*/</span>
<a name="line24"></a>&nbsp;
<a name="line25"></a><span style="color: #000000; font-weight: bold;">namespace</span> PHPCR\Lock<span style="color: #339933;">;</span>
<a name="line26"></a>&nbsp;
<a name="line27"></a><span style="color: #009933; font-style: italic;">/**
<a name="line28"></a> * This interface encapsulates methods for the management of locks.
<a name="line29"></a> *
<a name="line30"></a> * The \Traversable interface enables the implementation to be addressed with
<a name="line31"></a> * &lt;b&gt;foreach&lt;/b&gt;. LockManager has to implement either \IteratorAggregate or
<a name="line32"></a> * \Iterator.
<a name="line33"></a> * The iterator is equivalent to &lt;b&gt;getLockTokens()&lt;/b&gt; returning a list of all
<a name="line34"></a> * locks. The iterator keys have no significant meaning.
<a name="line35"></a> *
<a name="line36"></a> * @package phpcr
<a name="line37"></a> * @subpackage interfaces
<a name="line38"></a> * @api
<a name="line39"></a> */</span>
<a name="line40"></a><span style="color: #000000; font-weight: bold;">interface</span> LockManagerInterface <span style="color: #000000; font-weight: bold;">extends</span> \Traversable
<a name="line41"></a><span style="color: #009900;">&#123;</span>
<a name="line42"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line43"></a>     * Adds the specified lock token to the current Session.
<a name="line44"></a>     *
<a name="line45"></a>     * Holding a lock token makes the current Session the owner of the lock
<a name="line46"></a>     * specified by that particular lock token.
<a name="line47"></a>     *
<a name="line48"></a>     * @param string $lockToken A lock token (a string).
<a name="line49"></a>     *
<a name="line50"></a>     * @return void
<a name="line51"></a>     *
<a name="line52"></a>     * @throws \PHPCR\Lock\LockException if the specified lock token is already
<a name="line53"></a>     *      held by another Session and the implementation does not support
<a name="line54"></a>     *      simultaneous ownership of open-scoped locks.
<a name="line55"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line56"></a>     *
<a name="line57"></a>     * @api
<a name="line58"></a>     */</span>
<a name="line59"></a>    <span style="color: #000000; font-weight: bold;">function</span> addLockToken<span style="color: #009900;">&#40;</span><span style="color: #000088;">$lockToken</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line60"></a>&nbsp;
<a name="line61"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line62"></a>     * Returns the Lock object that applies to the node at the specified
<a name="line63"></a>     * absPath.
<a name="line64"></a>     *
<a name="line65"></a>     * This may be either a lock on that node itself or a deep lock on a node
<a name="line66"></a>     * above that node.
<a name="line67"></a>     *
<a name="line68"></a>     * @param string $absPath absolute path of node for which to obtain the
<a name="line69"></a>     *      lock.
<a name="line70"></a>     *
<a name="line71"></a>     * @return \PHPCR\Lock\LockInterface The applicable Lock object.
<a name="line72"></a>     *
<a name="line73"></a>     * @throws \PHPCR\Lock\LockException if no lock applies to this node.
<a name="line74"></a>     * @throws \PHPCR\AccessDeniedException if the current session does not
<a name="line75"></a>     *      have sufficient access to get the lock.
<a name="line76"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line77"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line78"></a>     *
<a name="line79"></a>     * @api
<a name="line80"></a>     */</span>
<a name="line81"></a>    <span style="color: #000000; font-weight: bold;">function</span> getLock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line82"></a>&nbsp;
<a name="line83"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line84"></a>     * Gets the list of previously registered tokens.
<a name="line85"></a>     *
<a name="line86"></a>     * Returns an array containing all lock tokens currently held by the
<a name="line87"></a>     * current Session. Note that any such tokens will represent open-scoped
<a name="line88"></a>     * locks, since session-scoped locks do not have tokens.
<a name="line89"></a>     *
<a name="line90"></a>     * @return array an array of lock tokens (strings)
<a name="line91"></a>     *
<a name="line92"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line93"></a>     *
<a name="line94"></a>     * @api
<a name="line95"></a>     */</span>
<a name="line96"></a>    <span style="color: #000000; font-weight: bold;">function</span> getLockTokens<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line97"></a>&nbsp;
<a name="line98"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line99"></a>     * Determines if the node identified by the passed path holds a lock.
<a name="line100"></a>     *
<a name="line101"></a>     * Returns true if the node at absPath holds a lock; otherwise returns
<a name="line102"></a>     * false. To hold a lock means that this node has actually had a lock
<a name="line103"></a>     * placed on it specifically, as opposed to just having a lock apply to it
<a name="line104"></a>     * due to a deep lock held by a node above.
<a name="line105"></a>     *
<a name="line106"></a>     * @param string $absPath The absolute path of node to be checked.
<a name="line107"></a>     *
<a name="line108"></a>     * @return boolean True, if the node identified by the given path holds a
<a name="line109"></a>     *      lock, else false.
<a name="line110"></a>     *
<a name="line111"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line112"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line113"></a>     *
<a name="line114"></a>     * @api
<a name="line115"></a>     */</span>
<a name="line116"></a>    <span style="color: #000000; font-weight: bold;">function</span> holdsLock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line117"></a>&nbsp;
<a name="line118"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line119"></a>     * Places a lock on the node at absPath.
<a name="line120"></a>     *
<a name="line121"></a>     * If successful, the node is said to hold the lock.
<a name="line122"></a>     *
<a name="line123"></a>     * If &lt;b&gt;isDeep&lt;/b&gt; is true then the lock applies to the specified node and
<a name="line124"></a>     * all its descendant nodes; if false, the lock applies only to the
<a name="line125"></a>     * specified node. On a successful lock, the jcr:lockIsDeep property of the
<a name="line126"></a>     * locked node is set to this value.
<a name="line127"></a>     *
<a name="line128"></a>     * If &lt;b&gt;isSessionScoped&lt;/b&gt; is true then this lock will expire upon the
<a name="line129"></a>     * expiration of the current session (either through an automatic or
<a name="line130"></a>     * explicit SessionInterface::logout()); if false, this lock does not
<a name="line131"></a>     * expire until it is explicitly unlocked, it times out, or it is
<a name="line132"></a>     * automatically unlocked due to a implementation-specific limitation.
<a name="line133"></a>     *
<a name="line134"></a>     * The &lt;b&gt;timeout&lt;/b&gt; parameter specifies the number of seconds until the
<a name="line135"></a>     * lock times out (if it is not refreshed with LockInterface::refresh() in
<a name="line136"></a>     * the meantime). An implementation may use this information as a hint or
<a name="line137"></a>     * ignore it altogether. Clients can discover the actual timeout by
<a name="line138"></a>     * inspecting the returned Lock object.
<a name="line139"></a>     *
<a name="line140"></a>     * The &lt;b&gt;ownerInfo&lt;/b&gt; parameter can be used to pass a string holding
<a name="line141"></a>     * owner information relevant to the client. An implementation may either
<a name="line142"></a>     * use or ignore this parameter. If it uses the parameter it must set the
<a name="line143"></a>     * jcr:lockOwner property of the locked node to this value and return this
<a name="line144"></a>     * value on LockInterface::getLockOwner(). If it ignores this parameter the
<a name="line145"></a>     * jcr:lockOwner property (and the value returned by
<a name="line146"></a>     * LockInterface::getLockOwner()) is set to either the value returned by
<a name="line147"></a>     * SessionInterface::getUserID() of the owning session or an
<a name="line148"></a>     * implementation-specific string identifying the owner.
<a name="line149"></a>     *
<a name="line150"></a>     * The method returns a Lock object representing the new lock. If the lock
<a name="line151"></a>     * is open-scoped the returned lock will include a lock token. The lock
<a name="line152"></a>     * token is also automatically added to the set of lock tokens held by the
<a name="line153"></a>     * current session.
<a name="line154"></a>     *
<a name="line155"></a>     * The addition or change of the properties jcr:lockIsDeep and
<a name="line156"></a>     * jcr:lockOwnerare persisted immediately; there is no need to call save.
<a name="line157"></a>     *
<a name="line158"></a>     * It is possible to lock a node even if it is checked-in.
<a name="line159"></a>     *
<a name="line160"></a>     * @param string $absPath The absolute path of node to be locked
<a name="line161"></a>     * @param boolean $isDeep If true this lock will apply to this node and all
<a name="line162"></a>     *      its descendants; if false, it applies only to this node.
<a name="line163"></a>     * @param boolean $isSessionScoped If true, this lock expires with the
<a name="line164"></a>     *      current session; if false it expires when explicitly or
<a name="line165"></a>     *      automatically unlocked for some other reason.
<a name="line166"></a>     * @param integer $timeoutHint Desired lock timeout in seconds (servers are
<a name="line167"></a>     *      free to ignore this value); specify PHP_INT_MAX for no timeout. If
<a name="line168"></a>     *      not specified, defaults to no timeout.
<a name="line169"></a>     * @param string $ownerInfo A string containing owner information supplied
<a name="line170"></a>     *      by the client; servers are free to ignore this value. If none is
<a name="line171"></a>     *      specified, the implementation chooses one (i.e. user name of
<a name="line172"></a>     *      current backend authentication credentials)
<a name="line173"></a>     *
<a name="line174"></a>     * @return \PHPCR\Lock\LockInterface A Lock object containing a lock token.
<a name="line175"></a>     *
<a name="line176"></a>     * @throws \PHPCR\Lock\LockException if this node is not mix:lockable or
<a name="line177"></a>     *      this node is already locked or isDeep is true and a descendant node
<a name="line178"></a>     *      of this node already holds a lock.
<a name="line179"></a>     * @throws \PHPCR\AccessDeniedException if this session does not have
<a name="line180"></a>     *      sufficient access to lock this node.
<a name="line181"></a>     * @throws \PHPCR\InvalidItemStateException if this node has pending
<a name="line182"></a>     *      unsaved changes.
<a name="line183"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line184"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line185"></a>     *
<a name="line186"></a>     * @api
<a name="line187"></a>     */</span>
<a name="line188"></a>    <span style="color: #000000; font-weight: bold;">function</span> lock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> <span style="color: #000088;">$isDeep</span><span style="color: #339933;">,</span> <span style="color: #000088;">$isSessionScoped</span><span style="color: #339933;">,</span> <span style="color: #000088;">$timeoutHint</span> <span style="color: #339933;">=</span> PHP_INT_MAX<span style="color: #339933;">,</span> <span style="color: #000088;">$ownerInfo</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line189"></a>&nbsp;
<a name="line190"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line191"></a>     * Determines if the node at absPath is locked.
<a name="line192"></a>     *
<a name="line193"></a>     * Returns true if the node at absPath is locked either as a result of a
<a name="line194"></a>     * lock held by that node or by a deep lock on a node above that node;
<a name="line195"></a>     * otherwise returns false.
<a name="line196"></a>     *
<a name="line197"></a>     * @param string $absPath The absolute path of a node to be checked.
<a name="line198"></a>     *
<a name="line199"></a>     * @return boolean True, if the identified node has a lock.
<a name="line200"></a>     *
<a name="line201"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath.
<a name="line202"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line203"></a>     *
<a name="line204"></a>     * @api
<a name="line205"></a>     */</span>
<a name="line206"></a>    <span style="color: #000000; font-weight: bold;">function</span> isLocked<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line207"></a>&nbsp;
<a name="line208"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line209"></a>     * Removes the specified lock token from this Session.
<a name="line210"></a>     *
<a name="line211"></a>     * @param string $lockToken - a lock token (a string)
<a name="line212"></a>     *
<a name="line213"></a>     * @return void
<a name="line214"></a>     *
<a name="line215"></a>     * @throws \PHPCR\Lock\LockException if the current Session does not hold
<a name="line216"></a>     *      the specified lock token.
<a name="line217"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line218"></a>     *
<a name="line219"></a>     * @api
<a name="line220"></a>     */</span>
<a name="line221"></a>    <span style="color: #000000; font-weight: bold;">function</span> removeLockToken<span style="color: #009900;">&#40;</span><span style="color: #000088;">$lockToken</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line222"></a>&nbsp;
<a name="line223"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line224"></a>     * Removes the lock on the node at absPath.
<a name="line225"></a>     *
<a name="line226"></a>     * Also removes the properties jcr:lockOwner and jcr:lockIsDeep from that
<a name="line227"></a>     * node. As well, the corresponding lock token is removed from the set of
<a name="line228"></a>     * lock tokens held by the current Session.
<a name="line229"></a>     *
<a name="line230"></a>     * If the node does not currently hold a lock or holds a lock for which
<a name="line231"></a>     * this Session is not the owner and is not a &quot;lock-superuser&quot;, then a
<a name="line232"></a>     * \PHPCR\Lock\LockException is thrown.
<a name="line233"></a>     *
<a name="line234"></a>     * &lt;b&gt;Note:&lt;/b&gt;
<a name="line235"></a>     * However that the system may give permission to a non-owning session
<a name="line236"></a>     * to unlock a lock. Typically such &quot;lock-superuser&quot; capability is intended
<a name="line237"></a>     * to facilitate administrational clean-up of orphaned open-scoped locks.
<a name="line238"></a>     *
<a name="line239"></a>     * Note that it is possible to unlock a node even if it is checked-in (the
<a name="line240"></a>     * lock-related properties will be changed despite the checked-in status).
<a name="line241"></a>     *
<a name="line242"></a>     * @param string $absPath The absolute path of node to be unlocked.
<a name="line243"></a>     *
<a name="line244"></a>     * @return void
<a name="line245"></a>     *
<a name="line246"></a>     * @throws \PHPCR\Lock\LockException If this node does not currently hold a
<a name="line247"></a>     *      lock or holds a lock for which this Session does not have the
<a name="line248"></a>     *      correct lock token.
<a name="line249"></a>     * @throws \PHPCR\AccessDeniedException if the current session does not
<a name="line250"></a>     *      have permission to unlock this node.
<a name="line251"></a>     * @throws \PHPCR\InvalidItemStateException if this node has pending
<a name="line252"></a>     *      unsaved changes.
<a name="line253"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line254"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line255"></a>     *
<a name="line256"></a>     * @api
<a name="line257"></a>     */</span>
<a name="line258"></a>    <span style="color: #000000; font-weight: bold;">function</span> unlock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line259"></a><span style="color: #009900;">&#125;</span>
<a name="line260"></a>&nbsp;</pre>
<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/lock/lockmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>