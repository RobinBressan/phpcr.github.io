<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Wed, 20 Jul 2011 12:10:28 +0000">

<link rel="stylesheet" type="text/css" href="../../../stylesheet.css">
<link rel="start" href="../../../overview-summary.html">

<title>PHPCR/Version/VersionHistoryInterface.php (PHPCR API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/version/versionhistoryinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>PHPCR/Version/VersionHistoryInterface.php</h1>
<div class="comment" id="overview_description"><p>This file is part of the PHPCR API and was originally ported from the Java
JCR API to PHP by Karsten Dambekalns for the FLOW3 project.</p><p>Copyright 2008-2011 Karsten Dambekalns <karsten@typo3.org></p><p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p><p>http://www.apache.org/licenses/LICENSE-2.0</p><p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div>

<hr>

<a name="line1"></a><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<a name="line2"></a>&nbsp;
<a name="line3"></a><span style="color: #009933; font-style: italic;">/**
<a name="line4"></a> * This file is part of the PHPCR API and was originally ported from the Java
<a name="line5"></a> * JCR API to PHP by Karsten Dambekalns for the FLOW3 project.
<a name="line6"></a> *
<a name="line7"></a> * Copyright 2008-2011 Karsten Dambekalns &lt;karsten@typo3.org&gt;
<a name="line8"></a> *
<a name="line9"></a> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<a name="line10"></a> * you may not use this file except in compliance with the License.
<a name="line11"></a> * You may obtain a copy of the License at
<a name="line12"></a> *
<a name="line13"></a> *     http://www.apache.org/licenses/LICENSE-2.0
<a name="line14"></a> *
<a name="line15"></a> * Unless required by applicable law or agreed to in writing, software
<a name="line16"></a> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<a name="line17"></a> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<a name="line18"></a> * See the License for the specific language governing permissions and
<a name="line19"></a> * limitations under the License.
<a name="line20"></a> *
<a name="line21"></a> * @license http://www.apache.org/licenses/LICENSE-2.0 Apache Software License 2.0
<a name="line22"></a> * @link http://phpcr.github.com/
<a name="line23"></a>*/</span>
<a name="line24"></a>&nbsp;
<a name="line25"></a><span style="color: #000000; font-weight: bold;">namespace</span> PHPCR\Version<span style="color: #339933;">;</span>
<a name="line26"></a>&nbsp;
<a name="line27"></a><span style="color: #009933; font-style: italic;">/**
<a name="line28"></a> * A VersionHistory object wraps an nt:versionHistory node. It provides
<a name="line29"></a> * convenient access to version history information.
<a name="line30"></a> *
<a name="line31"></a> * Note: As this extends NodeInterface, foreach still iterates over the
<a name="line32"></a> * children and not over versions. If you want to use a foreach, you can use
<a name="line33"></a> * getAllVersions() to retrieve an iterator over versions.
<a name="line34"></a> *
<a name="line35"></a> * @package phpcr
<a name="line36"></a> * @subpackage interfaces
<a name="line37"></a> * @api
<a name="line38"></a> */</span>
<a name="line39"></a><span style="color: #000000; font-weight: bold;">interface</span> VersionHistoryInterface <span style="color: #000000; font-weight: bold;">extends</span> \PHPCR\NodeInterface
<a name="line40"></a><span style="color: #009900;">&#123;</span>
<a name="line41"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line42"></a>     * Returns the identifier of the versionable node for which this is the
<a name="line43"></a>     * version history.
<a name="line44"></a>     *
<a name="line45"></a>     * @return string the identifier of the versionable node for which this is the version history.
<a name="line46"></a>     *
<a name="line47"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line48"></a>     * @api
<a name="line49"></a>     */</span>
<a name="line50"></a>    <span style="color: #000000; font-weight: bold;">function</span> getVersionableIdentifier<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line51"></a>&nbsp;
<a name="line52"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line53"></a>     * Returns the root version of this version history.
<a name="line54"></a>     *
<a name="line55"></a>     * @return \PHPCR\Version\VersionInterface a Version object.
<a name="line56"></a>     *
<a name="line57"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line58"></a>     * @api
<a name="line59"></a>     */</span>
<a name="line60"></a>    <span style="color: #000000; font-weight: bold;">function</span> getRootVersion<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line61"></a>&nbsp;
<a name="line62"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line63"></a>     * This method returns an iterator over all the versions in the line of
<a name="line64"></a>     * descent from the root version to that base version within this history
<a name="line65"></a>     * that is bound to the workspace through which this VersionHistory was
<a name="line66"></a>     * accessed.
<a name="line67"></a>     *
<a name="line68"></a>     * Within a version history H, B is the base version bound to workspace W
<a name="line69"></a>     * if and only if there exists a versionable node N in W whose version
<a name="line70"></a>     * history is H and B is the base version of N.
<a name="line71"></a>     *
<a name="line72"></a>     * The line of descent from version V1 to V2, where V2 is a successor of V1,
<a name="line73"></a>     * is the ordered list of versions starting with V1 and proceeding through
<a name="line74"></a>     * each direct successor to V2.
<a name="line75"></a>     *
<a name="line76"></a>     * The versions are returned in order of creation date, from oldest to newest.
<a name="line77"></a>     *
<a name="line78"></a>     * Note that in a simple versioning repository the behavior of this method is
<a name="line79"></a>     * equivalent to returning all versions in the version history in order from
<a name="line80"></a>     * oldest to newest.
<a name="line81"></a>     *
<a name="line82"></a>     * @return Iterator implementing &lt;b&gt;SeekableIterator&lt;/b&gt; and &lt;b&gt;Countable&lt;/b&gt;.
<a name="line83"></a>     *                  Values are the VersionInterface instances. Keys have no meaning.
<a name="line84"></a>     *
<a name="line85"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line86"></a>     * @api
<a name="line87"></a>     */</span>
<a name="line88"></a>    <span style="color: #000000; font-weight: bold;">function</span> getAllLinearVersions<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line89"></a>&nbsp;
<a name="line90"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line91"></a>     * Returns an iterator over all the versions within this version history.
<a name="line92"></a>     * If the version graph of this history is linear then the versions are
<a name="line93"></a>     * returned in order of creation date, from oldest to newest. Otherwise the
<a name="line94"></a>     * order of the returned versions is implementation-dependent.
<a name="line95"></a>     *
<a name="line96"></a>     * @return Iterator implementing &lt;b&gt;SeekableIterator&lt;/b&gt; and &lt;b&gt;Countable&lt;/b&gt;.
<a name="line97"></a>     *                  Values are the VersionInterface instances. Keys have no meaning.
<a name="line98"></a>     *
<a name="line99"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line100"></a>     * @api
<a name="line101"></a>     */</span>
<a name="line102"></a>    <span style="color: #000000; font-weight: bold;">function</span> getAllVersions<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line103"></a>&nbsp;
<a name="line104"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line105"></a>     * This method returns all the frozen nodes of all the versions in this
<a name="line106"></a>     * verison history in the same order as getAllLinearVersions().
<a name="line107"></a>     *
<a name="line108"></a>     * @return Iterator implementing &lt;b&gt;SeekableIterator&lt;/b&gt; and &lt;b&gt;Countable&lt;/b&gt;.
<a name="line109"></a>     *                  Values are the NodeInterface instances.
<a name="line110"></a>     *
<a name="line111"></a>     * @todo is there a version id to be used as key?
<a name="line112"></a>     *
<a name="line113"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line114"></a>     * @api
<a name="line115"></a>     */</span>
<a name="line116"></a>    <span style="color: #000000; font-weight: bold;">function</span> getAllLinearFrozenNodes<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line117"></a>&nbsp;
<a name="line118"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line119"></a>     * Returns an iterator over all the frozen nodes of all the versions of
<a name="line120"></a>     * this version history. Under simple versioning the order of the returned
<a name="line121"></a>     * nodes will be the order of their creation. Under full versioning the
<a name="line122"></a>     * order is implementation-dependent.
<a name="line123"></a>     *
<a name="line124"></a>     * @return Iterator implementing &lt;b&gt;SeekableIterator&lt;/b&gt; and &lt;b&gt;Countable&lt;/b&gt;.
<a name="line125"></a>     *                  Values are the NodeInterface instances.
<a name="line126"></a>     *
<a name="line127"></a>     * @todo is there a version id to be used as key?
<a name="line128"></a>     *
<a name="line129"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line130"></a>     * @api
<a name="line131"></a>     */</span>
<a name="line132"></a>    <span style="color: #000000; font-weight: bold;">function</span> getAllFrozenNodes<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line133"></a>&nbsp;
<a name="line134"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line135"></a>     * Retrieves a particular version from this version history by version name.
<a name="line136"></a>     *
<a name="line137"></a>     * @param string $versionName a version name
<a name="line138"></a>     * @return \PHPCR\Version\VersionInterface a Version object.
<a name="line139"></a>     *
<a name="line140"></a>     * @throws \PHPCR\Version\VersionException if the specified version is not in this version history.
<a name="line141"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line142"></a>     * @api
<a name="line143"></a>     */</span>
<a name="line144"></a>    <span style="color: #000000; font-weight: bold;">function</span> getVersion<span style="color: #009900;">&#40;</span><span style="color: #000088;">$versionName</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line145"></a>&nbsp;
<a name="line146"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line147"></a>     * Retrieves a particular version from this version history by version label.
<a name="line148"></a>     *
<a name="line149"></a>     * @param string $label a version label
<a name="line150"></a>     * @return \PHPCR\Version\VersionInterface a Version object.
<a name="line151"></a>     *
<a name="line152"></a>     * @throws \PHPCR\Version\VersionException if the specified label is not in this version history.
<a name="line153"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line154"></a>     * @api
<a name="line155"></a>     */</span>
<a name="line156"></a>    <span style="color: #000000; font-weight: bold;">function</span> getVersionByLabel<span style="color: #009900;">&#40;</span><span style="color: #000088;">$label</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line157"></a>&nbsp;
<a name="line158"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line159"></a>     * Adds the specified label to the specified version.
<a name="line160"></a>     *
<a name="line161"></a>     * The label must be a JCR name in either qualified or extended form
<a name="line162"></a>     * and therefore must conform to the syntax restriction that apply to
<a name="line163"></a>     * such names. In particular a colon (:) should not be used unless
<a name="line164"></a>     * it is intended as a prefix delimiter in a qualified name.
<a name="line165"></a>     *
<a name="line166"></a>     * Adding a version label to a version corresponds to
<a name="line167"></a>     * adding a reference property with a name specified by the label parameter
<a name="line168"></a>     * to the jcr:versionLabels sub node of the nt:versionHistory node. The
<a name="line169"></a>     * reference property points to the nt:version node that represents the
<a name="line170"></a>     * specified version.
<a name="line171"></a>     *
<a name="line172"></a>     * This is a workspace-write method and therefore the change is made
<a name="line173"></a>     * immediately.
<a name="line174"></a>     *
<a name="line175"></a>     * Within a particular version history, a given label may appear a maximum of
<a name="line176"></a>     * once. If the specified label is already assigned to a version in this
<a name="line177"></a>     * history and moveLabel is true then the label is removed from its current
<a name="line178"></a>     * location and added to the version with the specified versionName. If m
<a name="line179"></a>     * oveLabel is false, then an attempt to add a label that already exists
<a name="line180"></a>     * will fail.
<a name="line181"></a>     *
<a name="line182"></a>     * A VersionException is thrown if the named version is not in this
<a name="line183"></a>     * VersionHistory or if it is the root version (jcr:rootVersion) or if the
<a name="line184"></a>     * label specified is not a valid JCR NAME.
<a name="line185"></a>     *
<a name="line186"></a>     * @param string $versionName the name of the version to which the label is to be added.
<a name="line187"></a>     * @param string $label the label to be added, a JCR name in either extended or qualified form.
<a name="line188"></a>     * @param boolean $moveLabel if true, then if label is already assigned to a version in this version history,
<a name="line189"></a>     *                           it is moved to the new version specified; if false, then attempting to assign an
<a name="line190"></a>     *                           already used label will throw a LabelExistsVersionException.
<a name="line191"></a>     * @return void
<a name="line192"></a>     *
<a name="line193"></a>     * @throws \PHPCR\Version\LabelExistsVersionException if moveLabel is false, and an attempt is made to add a
<a name="line194"></a>     *                                                    label that already exists in this version history
<a name="line195"></a>     * @throws \PHPCR\Version\VersionException if the specified version does not exist in this version history
<a name="line196"></a>     *                                         or if the specified version is the root version (jcr:rootVersion).
<a name="line197"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line198"></a>     * @api
<a name="line199"></a>     */</span>
<a name="line200"></a>    <span style="color: #000000; font-weight: bold;">function</span> addVersionLabel<span style="color: #009900;">&#40;</span><span style="color: #000088;">$versionName</span><span style="color: #339933;">,</span> <span style="color: #000088;">$label</span><span style="color: #339933;">,</span> <span style="color: #000088;">$moveLabel</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line201"></a>&nbsp;
<a name="line202"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line203"></a>     * Removes the specified label from among the labels of this version history.
<a name="line204"></a>     * The label must be a JCR name in either qualified or extended form.
<a name="line205"></a>     * This corresponds to removing a property from the jcr:versionLabels child node
<a name="line206"></a>     * of the nt:versionHistory node that represents this version history.
<a name="line207"></a>     *
<a name="line208"></a>     * This is a workspace-write method and therefore the change is made
<a name="line209"></a>     * immediately.
<a name="line210"></a>     *
<a name="line211"></a>     * @param string $label a version label. A JCR name in either extended or qualified form.
<a name="line212"></a>     * @return void
<a name="line213"></a>     *
<a name="line214"></a>     * @throws \PHPCR\Version\VersionException if the name label does not exist in this version history.
<a name="line215"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line216"></a>     * @api
<a name="line217"></a>     */</span>
<a name="line218"></a>    <span style="color: #000000; font-weight: bold;">function</span> removeVersionLabel<span style="color: #009900;">&#40;</span><span style="color: #000088;">$label</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line219"></a>&nbsp;
<a name="line220"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line221"></a>     * Returns true if the given version has the given label. If no $version is given
<a name="line222"></a>     * returns true if any version in the history has the given label.
<a name="line223"></a>     * The label must be a JCR name in either qualified or extended form.
<a name="line224"></a>     *
<a name="line225"></a>     * &lt;b&gt;Note:&lt;/b&gt; The Java API defines this with multiple differing signatures.
<a name="line226"></a>     *
<a name="line227"></a>     * @param string $label a version label. A JCR name in either extended or qualified form.
<a name="line228"></a>     * @param \PHPCR\Version\VersionInterface $version a Version object
<a name="line229"></a>     * @return boolean a boolean.
<a name="line230"></a>     *
<a name="line231"></a>     * @throws \PHPCR\Version\VersionException if the specified version is not of this version history.
<a name="line232"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line233"></a>     * @api
<a name="line234"></a>     */</span>
<a name="line235"></a>    <span style="color: #000000; font-weight: bold;">function</span> hasVersionLabel<span style="color: #009900;">&#40;</span><span style="color: #000088;">$label</span><span style="color: #339933;">,</span> <span style="color: #000088;">$version</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line236"></a>&nbsp;
<a name="line237"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line238"></a>     * Returns all version labels of the given version - empty array if none.
<a name="line239"></a>     *
<a name="line240"></a>     * If a $version is given returns all version labels of the history or an empty
<a name="line241"></a>     * array if there are none.
<a name="line242"></a>     *
<a name="line243"></a>     * &lt;b&gt;Note:&lt;/b&gt; The Java API defines this with multiple differing signatures.
<a name="line244"></a>     *
<a name="line245"></a>     * @param VersionInterface $version a Version object
<a name="line246"></a>     * @return array a string array containing all the labels of the (given) version (history)
<a name="line247"></a>     *
<a name="line248"></a>     * @throws \PHPCR\Version\VersionException if the specified version is not in this version history.
<a name="line249"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line250"></a>     * @api
<a name="line251"></a>     */</span>
<a name="line252"></a>    <span style="color: #000000; font-weight: bold;">function</span> getVersionLabels<span style="color: #009900;">&#40;</span><span style="color: #000088;">$version</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line253"></a>&nbsp;
<a name="line254"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line255"></a>     * Removes the named version from this version history and automatically
<a name="line256"></a>     * repairs the version graph. If the version to be removed is V, V's
<a name="line257"></a>     * predecessor set is P and V's successor set is S, then the version graph
<a name="line258"></a>     * is repaired s follows:
<a name="line259"></a>     * - For each member of P, remove the reference to V from its successor list
<a name="line260"></a>     *   and add references to each member of S.
<a name="line261"></a>     * - For each member of S, remove the reference to V from its predecessor
<a name="line262"></a>     *   list and add references to each member of P.
<a name="line263"></a>     *
<a name="line264"></a>     * &lt;b&gt;Note&lt;/b&gt; that this change is made immediately; there is no need to call save.
<a name="line265"></a>     * In fact, since the the version storage is read-only with respect to normal
<a name="line266"></a>     * repository methods, save does not even function in this context.
<a name="line267"></a>     *
<a name="line268"></a>     * @param string $versionName the name of a version in this version history.
<a name="line269"></a>     * @return void
<a name="line270"></a>     *
<a name="line271"></a>     * @throws \PHPCR\ReferentialIntegrityException if the specified version is currently the target of a
<a name="line272"></a>     *                                              REFERENCE property elsewhere in the repository
<a name="line273"></a>     *                                              (not necessarily in this workspace) and the current Session
<a name="line274"></a>     *                                              has read access to that REFERENCE property.
<a name="line275"></a>     * @throws \PHPCR\AccessDeniedException if the current Session does not have permission to remove the
<a name="line276"></a>     *                                      specified version or if the specified version is currently the
<a name="line277"></a>     *                                      target of a REFERENCE property elsewhere in the repository
<a name="line278"></a>     *                                      (not just in this workspace) and the current Session does not have
<a name="line279"></a>     *                                      read access to that REFERENCE property.
<a name="line280"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if this operation is not supported by the implementation.
<a name="line281"></a>     * @throws \PHPCR\Version\VersionException if the named version is not in this version history.
<a name="line282"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line283"></a>     * @api
<a name="line284"></a>     */</span>
<a name="line285"></a>    <span style="color: #000000; font-weight: bold;">function</span> removeVersion<span style="color: #009900;">&#40;</span><span style="color: #000088;">$versionName</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line286"></a><span style="color: #009900;">&#125;</span>
<a name="line287"></a>&nbsp;</pre>
<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/version/versionhistoryinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>