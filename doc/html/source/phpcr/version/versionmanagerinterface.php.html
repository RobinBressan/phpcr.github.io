<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Wed, 20 Jul 2011 15:20:22 +0000">

<link rel="stylesheet" type="text/css" href="../../../stylesheet.css">
<link rel="start" href="../../../overview-summary.html">

<title>PHPCR/Version/VersionManagerInterface.php (PHPCR API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/version/versionmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>PHPCR/Version/VersionManagerInterface.php</h1>
<div class="comment" id="overview_description"><p>This file is part of the PHPCR API and was originally ported from the Java
JCR API to PHP by Karsten Dambekalns for the FLOW3 project.</p><p>Copyright 2008-2011 Karsten Dambekalns <karsten@typo3.org></p><p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p><p>http://www.apache.org/licenses/LICENSE-2.0</p><p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div>

<hr>

<a name="line1"></a><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<a name="line2"></a>&nbsp;
<a name="line3"></a><span style="color: #009933; font-style: italic;">/**
<a name="line4"></a> * This file is part of the PHPCR API and was originally ported from the Java
<a name="line5"></a> * JCR API to PHP by Karsten Dambekalns for the FLOW3 project.
<a name="line6"></a> *
<a name="line7"></a> * Copyright 2008-2011 Karsten Dambekalns &lt;karsten@typo3.org&gt;
<a name="line8"></a> *
<a name="line9"></a> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<a name="line10"></a> * you may not use this file except in compliance with the License.
<a name="line11"></a> * You may obtain a copy of the License at
<a name="line12"></a> *
<a name="line13"></a> *     http://www.apache.org/licenses/LICENSE-2.0
<a name="line14"></a> *
<a name="line15"></a> * Unless required by applicable law or agreed to in writing, software
<a name="line16"></a> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<a name="line17"></a> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<a name="line18"></a> * See the License for the specific language governing permissions and
<a name="line19"></a> * limitations under the License.
<a name="line20"></a> *
<a name="line21"></a> * @license http://www.apache.org/licenses/LICENSE-2.0 Apache Software License 2.0
<a name="line22"></a> * @link http://phpcr.github.com/
<a name="line23"></a>*/</span>
<a name="line24"></a>&nbsp;
<a name="line25"></a><span style="color: #000000; font-weight: bold;">namespace</span> PHPCR\Version<span style="color: #339933;">;</span>
<a name="line26"></a>&nbsp;
<a name="line27"></a><span style="color: #009933; font-style: italic;">/**
<a name="line28"></a> * The VersionManager object is accessed via WorkspaceInterface::getVersionManager(). It
<a name="line29"></a> * provides methods for:
<a name="line30"></a> * - Version graph functionality (version history, base version, successors predecessors)
<a name="line31"></a> * - Basic version operations (checkin, checkout, checkpoint)
<a name="line32"></a> * - Restore feature
<a name="line33"></a> * - Label feature
<a name="line34"></a> * - Merge feature
<a name="line35"></a> * - Configuration feature
<a name="line36"></a> * - Activity feature
<a name="line37"></a> *
<a name="line38"></a> * &amp;nbsp;
<a name="line39"></a> *
<a name="line40"></a> * @package phpcr
<a name="line41"></a> * @subpackage interfaces
<a name="line42"></a> * @api
<a name="line43"></a> */</span>
<a name="line44"></a><span style="color: #000000; font-weight: bold;">interface</span> VersionManagerInterface
<a name="line45"></a><span style="color: #009900;">&#123;</span>
<a name="line46"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line47"></a>     * Creates for the versionable node at absPath a new version with a system
<a name="line48"></a>     * generated version name and returns that version (which will be the new
<a name="line49"></a>     * base version of this node). Sets the jcr:checkedOut property to false
<a name="line50"></a>     * thus putting the node into the checked-in state. This means that the node
<a name="line51"></a>     * and its connected non-versionable subgraph become read-only. A node's
<a name="line52"></a>     * connected non-versionable subgraph is the set of non-versionable descendant
<a name="line53"></a>     * nodes reachable from that node through child links without encountering
<a name="line54"></a>     * any versionable nodes. In other words, the read-only status flows down
<a name="line55"></a>     * from the checked-in node along every child link until either a versionable
<a name="line56"></a>     * node is encountered or an item with no children is encountered. In a
<a name="line57"></a>     * system that supports only simple versioning the connected non-versionable
<a name="line58"></a>     * subgraph will be equivalent to the whole subgraph, since simple-versionable
<a name="line59"></a>     * nodes cannot have simple-versionable descendants.
<a name="line60"></a>     *
<a name="line61"></a>     * Read-only status means that an item cannot be altered by the client using
<a name="line62"></a>     * standard API methods (addNode, setProperty, etc.). The only exceptions to
<a name="line63"></a>     * this rule are the restore(), restoreByLabel(), merge() and Node::update()
<a name="line64"></a>     * operations; these do not respect read-only status due to check-in. Note
<a name="line65"></a>     * that remove of a read-only node is possible, as long as its parent is not
<a name="line66"></a>     * read-only (since removal is an alteration of the parent node).
<a name="line67"></a>     *
<a name="line68"></a>     * If this node is already checked-in, this method has no effect but returns
<a name="line69"></a>     * the current base version of this node.
<a name="line70"></a>     *
<a name="line71"></a>     * If checkin succeeds, the change to the jcr:isCheckedOut property is
<a name="line72"></a>     * dispatched immediately.
<a name="line73"></a>     *
<a name="line74"></a>     * @param string $absPath an absolute path.
<a name="line75"></a>     * @return \PHPCR\Version\VersionInterface the created version.
<a name="line76"></a>     * @throws \PHPCR\Verson\VersionException if jcr:predecessors does not contain at least one value or if a
<a name="line77"></a>     *                                        child item of the node at absPath has an OnParentVersion status of
<a name="line78"></a>     *                                         ABORT. This includes the case where an unresolved merge failure exists
<a name="line79"></a>     *                                         on the node, as indicated by the presence of a jcr:mergeFailed property.
<a name="line80"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException If the node at $absPath is not versionable.
<a name="line81"></a>     * @throws \PHPCR\InvalidItemStateException If unsaved changes exist on the node at $absPath.
<a name="line82"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the operation.
<a name="line83"></a>     * @throws \PHPCR\RepositoryException If another error occurs.
<a name="line84"></a>     * @api
<a name="line85"></a>     */</span>
<a name="line86"></a>    <span style="color: #000000; font-weight: bold;">function</span> checkin<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line87"></a>&nbsp;
<a name="line88"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line89"></a>     * Sets the versionable node at $absPath to checked-out status by setting
<a name="line90"></a>     * its jcr:isCheckedOut property to true. Under full versioning it also sets
<a name="line91"></a>     * the jcr:predecessors property to be a reference to the current base
<a name="line92"></a>     * version (the same value as held in jcr:baseVersion).
<a name="line93"></a>     *
<a name="line94"></a>     * This method puts the node into the checked-out state, making it and its
<a name="line95"></a>     * connected non-versionable subgraph no longer read-only (see checkin() for
<a name="line96"></a>     * an explanation of the term &quot;connected non-versionable subgraph&quot;. Under
<a name="line97"></a>     * simple versioning this will simply be the whole subgraph).
<a name="line98"></a>     *
<a name="line99"></a>     * If successful, these changes are persisted immediately, there is no need
<a name="line100"></a>     * to call save.
<a name="line101"></a>     *
<a name="line102"></a>     * If this node is already checked-out, this method has no effect.
<a name="line103"></a>     *
<a name="line104"></a>     * @param string $absPath an absolute path.
<a name="line105"></a>     * @return void
<a name="line106"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException If the node at absPath is not versionable.
<a name="line107"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the checkout.
<a name="line108"></a>     * @throws \PHPCR\Version\ActivityViolationException If the checkout conflicts with the activity present
<a name="line109"></a>     *                                                   on the current session.
<a name="line110"></a>     * @throws \PHPCR\RepositoryException If another error occurs.
<a name="line111"></a>     * @api
<a name="line112"></a>     */</span>
<a name="line113"></a>    <span style="color: #000000; font-weight: bold;">function</span> checkout<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line114"></a>&nbsp;
<a name="line115"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line116"></a>     * Performs a checkin() followed by a checkout() on the versionable node at
<a name="line117"></a>     * $absPath.
<a name="line118"></a>     *
<a name="line119"></a>     * If this node is already checked-in, this method is equivalent to checkout().
<a name="line120"></a>     *
<a name="line121"></a>     * @param string $absPath an absolute path.
<a name="line122"></a>     * @return \PHPCR\Version\VersionInterface the created version.
<a name="line123"></a>     * @throws \PHPCR\Version\VersionException if a child item of the node at absPath has an OnParentVersion of
<a name="line124"></a>     *                                         ABORT. This includes the case where an unresolved merge failure
<a name="line125"></a>     *                                         exists on the node, as indicated by the presence of the jcr:mergeFailed.
<a name="line126"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the node at absPath is not versionable.
<a name="line127"></a>     * @throws \PHPCR\InvalidItemStateException if there are unsaved changes pending on the node at absPath.
<a name="line128"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the operation.
<a name="line129"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line130"></a>     * @api
<a name="line131"></a>     */</span>
<a name="line132"></a>    <span style="color: #000000; font-weight: bold;">function</span> checkpoint<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line133"></a>&nbsp;
<a name="line134"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line135"></a>     * Returns true if the node at $absPath is either
<a name="line136"></a>     *  versionable (full or simple) and currently checked-out,
<a name="line137"></a>     *  non-versionable and its nearest versionable ancestor is checked-out or
<a name="line138"></a>     *  non-versionable and it has no versionable ancestor.
<a name="line139"></a>     *
<a name="line140"></a>     * Returns false if the node at $absPath is either
<a name="line141"></a>     *  versionable (full or simple) and currently checked-in or
<a name="line142"></a>     *  non-versionable and its nearest versionable ancestor is checked-in.
<a name="line143"></a>     *
<a name="line144"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line145"></a>     * @return boolean True, if the node identified by the given path is checked out, else false.
<a name="line146"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line147"></a>     * @api
<a name="line148"></a>     */</span>
<a name="line149"></a>    <span style="color: #000000; font-weight: bold;">function</span> isCheckedOut<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line150"></a>&nbsp;
<a name="line151"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line152"></a>     * Returns the VersionHistory object of the node at $absPath. This object
<a name="line153"></a>     * provides access to the nt:versionHistory node holding this node's versions.
<a name="line154"></a>     *
<a name="line155"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line156"></a>     * @return \PHPCR\Version\VersionHistoryInterface a VersionHistory object
<a name="line157"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the node at absPath is not versionable.
<a name="line158"></a>     * @throws \PHPCR\RepositoryException If another error occurs.
<a name="line159"></a>     * @api
<a name="line160"></a>     */</span>
<a name="line161"></a>    <span style="color: #000000; font-weight: bold;">function</span> getVersionHistory<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line162"></a>&nbsp;
<a name="line163"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line164"></a>     * Returns the current base version of the versionable node at absPath.
<a name="line165"></a>     *
<a name="line166"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line167"></a>     * @return \PHPCR\Version\VersionInterface a Version object.
<a name="line168"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the node at absPath is not versionable.
<a name="line169"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line170"></a>     * @api
<a name="line171"></a>     */</span>
<a name="line172"></a>    <span style="color: #000000; font-weight: bold;">function</span> getBaseVersion<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line173"></a>&nbsp;
<a name="line174"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line175"></a>     * If $absPath is given and $version is a version name:
<a name="line176"></a>     *  Restores the node at $absPath to the state defined by the version with
<a name="line177"></a>     *  the specified version name ($version).
<a name="line178"></a>     *  This method will work regardless of whether the node at absPath is
<a name="line179"></a>     *  checked-in or not.
<a name="line180"></a>     *
<a name="line181"></a>     *
<a name="line182"></a>     * If $absPath is given and $version is a VersionInterface instance:
<a name="line183"></a>     *  Restores the specified version to $absPath. There must be no existing
<a name="line184"></a>     *  node at $absPath. If one exists, a VersionException is thrown.
<a name="line185"></a>     *  There must be a parent node to the location at $absPath, otherwise a
<a name="line186"></a>     *  PathNotFoundException is thrown.
<a name="line187"></a>     *  If the would-be parent of the location $absPath is actually a property,
<a name="line188"></a>     *  or if a node type restriction would be violated, then a
<a name="line189"></a>     *  ConstraintViolationException is thrown.
<a name="line190"></a>     *
<a name="line191"></a>     *
<a name="line192"></a>     * If $version is VersionInterface instance:
<a name="line193"></a>     *  Restores the node in the current workspace that is the versionable node
<a name="line194"></a>     *  of the specified version to the state reflected in that version.
<a name="line195"></a>     *  This method ignores checked-in status.
<a name="line196"></a>     *
<a name="line197"></a>     *
<a name="line198"></a>     * If $version is an array of VersionInterface instances:
<a name="line199"></a>     *  Restores a set of versions at once. Used in cases where a &quot;chicken and
<a name="line200"></a>     *  egg&quot; problem of mutually referring REFERENCE properties would prevent
<a name="line201"></a>     *  the restore in any serial order.
<a name="line202"></a>     *  The following restrictions apply to the set of versions specified: If S
<a name="line203"></a>     *  is the set of versions being restored simultaneously,
<a name="line204"></a>     *  - For every version V in S that corresponds to a missing node, there
<a name="line205"></a>     *    must also be a parent of V in S.
<a name="line206"></a>     *  - S must contain at least one version that corresponds to an existing
<a name="line207"></a>     *    node in the workspace.
<a name="line208"></a>     *  - No V in S can be a root version (jcr:rootVersion).
<a name="line209"></a>     *  If any of these restrictions does not hold, the restore will fail
<a name="line210"></a>     *  because the system will be unable to determine the path locations to
<a name="line211"></a>     *  which one or more versions are to be restored. In this case a
<a name="line212"></a>     *  VersionException is thrown.
<a name="line213"></a>     *  The versionable nodes in the current workspace that correspond to the
<a name="line214"></a>     *  versions being restored define a set of (one or more) subgraphs.
<a name="line215"></a>     *
<a name="line216"></a>     * If the restore succeeds the changes made are dispatched immediately;
<a name="line217"></a>     * there is no need to call save.
<a name="line218"></a>     *
<a name="line219"></a>     * If an array of VersionInterface instances is restored, an identifier
<a name="line220"></a>     * collision occurs when the current workspace contains a node outside these
<a name="line221"></a>     * subgraphs that has the same identifier as one of the nodes that would be
<a name="line222"></a>     * introduced by the restore operation into one of these subgraphs.
<a name="line223"></a>     * Else, an identifier collision occurs when a node exists outside the
<a name="line224"></a>     * subgraph rooted at absPath with the same identifier as a node that would
<a name="line225"></a>     * be introduced by the restore operation into the affected subgraph.
<a name="line226"></a>     * The result in such a case is governed by the removeExisting flag. If
<a name="line227"></a>     * $removeExisting is true, then the incoming node takes precedence, and the
<a name="line228"></a>     * existing node (and its subgraph) is removed (if possible; otherwise a
<a name="line229"></a>     * RepositoryException is thrown). If $removeExisting is false, then an
<a name="line230"></a>     * ItemExistsException is thrown and no changes are made. Note that this
<a name="line231"></a>     * applies not only to cases where the restored node itself conflicts with
<a name="line232"></a>     * an existing node but also to cases where a conflict occurs with any node
<a name="line233"></a>     * that would be introduced into the workspace by the restore operation. In
<a name="line234"></a>     * particular, conflicts involving subnodes of the restored node that have
<a name="line235"></a>     * OnParentVersion settings of COPY or VERSION are also governed by the
<a name="line236"></a>     * $removeExisting flag.
<a name="line237"></a>     *
<a name="line238"></a>     * &lt;b&gt;Note:&lt;/b&gt; The Java API defines this with multiple differing signatures, you
<a name="line239"></a>     * need to act accordingly in your implementation.
<a name="line240"></a>     *
<a name="line241"></a>     * @param boolean $removeExisting a boolean flag that governs what happens in case of an identifier collision
<a name="line242"></a>     * @param string|array|\PHPCR\Version\VersionInterface $version a version name, an an array of Version objects
<a name="line243"></a>     *                                                              or a Version object
<a name="line244"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line245"></a>     * @return void
<a name="line246"></a>     * @throws \PHPCR\Version\VersionException if the specified version does not have a corresponding node in
<a name="line247"></a>     *                                         the workspace this VersionManager has been created for or if an
<a name="line248"></a>     *                                         attempt is made to restore the root version (jcr:rootVersion).
<a name="line249"></a>     * @throws \PHPCR\ItemExistsException if $removeExisting is false and an identifier collision occurs or a
<a name="line250"></a>     *                                    node exists at $absPath.
<a name="line251"></a>     * @throws \PHPCR\InvalidItemStateException if this Session has pending unsaved changes.
<a name="line252"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if versioning is not supported.
<a name="line253"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the restore.
<a name="line254"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line255"></a>     * @api
<a name="line256"></a>     */</span>
<a name="line257"></a>    <span style="color: #000000; font-weight: bold;">function</span> restore<span style="color: #009900;">&#40;</span><span style="color: #000088;">$removeExisting</span><span style="color: #339933;">,</span> <span style="color: #000088;">$version</span><span style="color: #339933;">,</span> <span style="color: #000088;">$absPath</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line258"></a>&nbsp;
<a name="line259"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line260"></a>     * Restores the version of the node at absPath with the specified version
<a name="line261"></a>     * label. If this node is not versionable, an UnsupportedRepositoryOperationException
<a name="line262"></a>     * is thrown. If successful, the change is persisted immediately and there
<a name="line263"></a>     * is no need to call save.
<a name="line264"></a>     *
<a name="line265"></a>     * This method will work regardless of whether the node at absPath is
<a name="line266"></a>     * checked-in or not.
<a name="line267"></a>     *
<a name="line268"></a>     * An identifier collision occurs when a node exists outside the subgraph
<a name="line269"></a>     * rooted at this node with the same identifier as a node that would be
<a name="line270"></a>     * introduced by the restoreByLabel operation into the subgraph at this node.
<a name="line271"></a>     * The result in such a case is governed by the removeExisting flag. If
<a name="line272"></a>     * removeExisting is true, then the incoming node takes precedence, and the
<a name="line273"></a>     * existing node (and its subgraph) is removed (if possible; otherwise a
<a name="line274"></a>     * RepositoryException is thrown). If removeExisting is false, then a
<a name="line275"></a>     * ItemExistsException is thrown and no changes are made. Note that this
<a name="line276"></a>     * applies not only to cases where the restored node itself conflicts with
<a name="line277"></a>     * an existing node but also to cases where a conflict occurs with any node
<a name="line278"></a>     * that would be introduced into the workspace by the restore operation. In
<a name="line279"></a>     * particular, conflicts involving subnodes of the restored node that have
<a name="line280"></a>     * OnParentVersion settings of COPY or VERSION are also governed by the
<a name="line281"></a>     * removeExisting flag.
<a name="line282"></a>     *
<a name="line283"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line284"></a>     * @param string $versionLabel a String
<a name="line285"></a>     * @param boolean $removeExisting a boolean flag that governs what happens in case of an identifier collision.
<a name="line286"></a>     * @return void
<a name="line287"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the node at absPath is not versionable.
<a name="line288"></a>     * @throws \PHPCR\Version\VersionException if the specified versionLabel does not exist in this node's version history.
<a name="line289"></a>     * @throws \PHPCR\ItemExistsException if removeExisting is false and an identifier collision occurs.
<a name="line290"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the restore.
<a name="line291"></a>     * @throws \PHPCR\InvalidItemStateException if this Session (not necessarily the Node at absPath) has
<a name="line292"></a>     *                                          pending unsaved changes.
<a name="line293"></a>     * @throws \PHPCR\RepositoryException If another error occurs.
<a name="line294"></a>     * @api
<a name="line295"></a>     */</span>
<a name="line296"></a>    <span style="color: #000000; font-weight: bold;">function</span> restoreByLabel<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> <span style="color: #000088;">$versionLabel</span><span style="color: #339933;">,</span> <span style="color: #000088;">$removeExisting</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line297"></a>&nbsp;
<a name="line298"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line299"></a>     * If an nt:activity Node is given:
<a name="line300"></a>     *
<a name="line301"></a>     * This method merges the changes that were made under the specified activity
<a name="line302"></a>     * into the current workspace.
<a name="line303"></a>     *
<a name="line304"></a>     * An activity A will be associated with a set of versions through the
<a name="line305"></a>     * jcr:activity reference of each version node in the set. We call each such
<a name="line306"></a>     * associated version a member of A.
<a name="line307"></a>     *
<a name="line308"></a>     * For each version history H that contains one or more members of A, one
<a name="line309"></a>     * such member will be the latest member of A in H. The latest member of A
<a name="line310"></a>     * in H is the version in H that is a member of A and that has no successor
<a name="line311"></a>     * versions (to any degree) that are also members of A.
<a name="line312"></a>     *
<a name="line313"></a>     * The set of versions that are the latest members of A in their respective
<a name="line314"></a>     * version histories is called the change set of A. It fully describes the
<a name="line315"></a>     * changes made under the activity A.
<a name="line316"></a>     *
<a name="line317"></a>     * This method performs a shallow merge into the current workspace of each
<a name="line318"></a>     * version in the change set of the activity specified by activityNode. If
<a name="line319"></a>     * there is no corresponding node in this workspace for a given member of
<a name="line320"></a>     * the change set, that member is ignored.
<a name="line321"></a>     *
<a name="line322"></a>     *
<a name="line323"></a>     * If an absolute path is given:
<a name="line324"></a>     *
<a name="line325"></a>     * This method can be thought of as a version-sensitive update.
<a name="line326"></a>     *
<a name="line327"></a>     * If isShallow is true, it tests the node at absPath against its
<a name="line328"></a>     * corresponding node in srcWorkspace with respect to the relation between
<a name="line329"></a>     * their respective base versions and either updates the node in question or
<a name="line330"></a>     * not, depending on the outcome of the test.
<a name="line331"></a>     *
<a name="line332"></a>     * If isShallow is false, this method recursively tests each versionable
<a name="line333"></a>     * node in the subgraph as mentioned above.
<a name="line334"></a>     *
<a name="line335"></a>     * If isShallow is true and this node is not versionable, then this method
<a name="line336"></a>     * returns and no changes are made.
<a name="line337"></a>     *
<a name="line338"></a>     * A MergeException is thrown if bestEffort is false and a versionable node
<a name="line339"></a>     * is encountered whose corresponding node's base version is on a divergent
<a name="line340"></a>     * branch from the base version of the node at absPath.
<a name="line341"></a>     *
<a name="line342"></a>     * This is a worksapce-write method and therefore any changes are dispatched
<a name="line343"></a>     * immediately.
<a name="line344"></a>     *
<a name="line345"></a>     * This method returns an iterator over all versionable nodes in the
<a name="line346"></a>     * subgraph that received a merge result of fail. If bestEffort is false,
<a name="line347"></a>     * this iterator will be empty (since if merge returns successfully, instead
<a name="line348"></a>     * of throwing an exception, it will be because no failures were encountered).
<a name="line349"></a>     * If bestEffort is true, this iterator will contain all nodes that received
<a name="line350"></a>     * a fail during the course of this merge operation.
<a name="line351"></a>     *
<a name="line352"></a>     *
<a name="line353"></a>     * See the JCR specifications for more details on the behavior of this
<a name="line354"></a>     * method.
<a name="line355"></a>     *
<a name="line356"></a>     * Note: The Java API defines this with multiple differing signatures.
<a name="line357"></a>     *
<a name="line358"></a>     * @param string|\PHPCR\NodeInterface $source an absolute path or an nt:activity node.
<a name="line359"></a>     * @param string $srcWorkspace the name of the source workspace (optional if $source is a Node).
<a name="line360"></a>     * @param boolean $bestEffort a boolean (optional if $source is a Node)
<a name="line361"></a>     * @param boolean $isShallow a boolean (optional)
<a name="line362"></a>     * @return Iterator implementing &lt;b&gt;SeekableIterator&lt;/b&gt; and &lt;b&gt;Countable&lt;/b&gt;. Keys are the Node names,
<a name="line363"></a>     *                  values the corresponding NodeInterface instances that received a merge result of &quot;fail&quot; in
<a name="line364"></a>     *                  the course of this operation.
<a name="line365"></a>     * @throws \PHPCR\MergeException - if bestEffort is false and a failed merge result is encountered.
<a name="line366"></a>     * @throws \PHPCR\InvalidItemStateException if this session (not necessarily the node at absPath) has
<a name="line367"></a>     *                                          pending unsaved changes.
<a name="line368"></a>     * @throws \PHPCR\NoSuchWorkspaceException if srcWorkspace does not exist.
<a name="line369"></a>     * @throws \PHPCR\AccessDeniedException if the current session does not have sufficient rights to
<a name="line370"></a>     *                                      perform the operation.
<a name="line371"></a>     * @throws \PHPCR\Lock\LockException if a lock prevents the merge.
<a name="line372"></a>     * @throws \PHPCR\Version\VersionException if the specified node is not an nt:activity node.
<a name="line373"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if this operation is not supported by this implementation.
<a name="line374"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line375"></a>     * @api
<a name="line376"></a>     */</span>
<a name="line377"></a>    <span style="color: #000000; font-weight: bold;">function</span> merge<span style="color: #009900;">&#40;</span><span style="color: #000088;">$source</span><span style="color: #339933;">,</span> <span style="color: #000088;">$srcWorkspace</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$bestEffort</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$isShallow</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line378"></a>&nbsp;
<a name="line379"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line380"></a>     * Completes the merge process with respect to the node at absPath and the
<a name="line381"></a>     * specified version.
<a name="line382"></a>     *
<a name="line383"></a>     * When the merge(string, string, boolean) method is called on a node, every
<a name="line384"></a>     * versionable node in that subgraph is compared with its corresponding node
<a name="line385"></a>     * in the indicated other workspace and a &quot;merge test result&quot; is determined
<a name="line386"></a>     * indicating one of the following:
<a name="line387"></a>     *
<a name="line388"></a>     * &lt;ol&gt;
<a name="line389"></a>     * &lt;li&gt;This node will be updated to the state of its correspondee (if the base
<a name="line390"></a>     *    version of the correspondee is more recent in terms of version history)&lt;/li&gt;
<a name="line391"></a>     * &lt;li&gt;This node will be left alone (if this node's base version is more recent
<a name="line392"></a>     *    in terms of version history).&lt;/li&gt;
<a name="line393"></a>     * &lt;li&gt;This node will be marked as having failed the merge test (if this node's
<a name="line394"></a>     *    base version is on a different branch of the version history from the
<a name="line395"></a>     *    base version of its corresponding node in the other workspace, thus
<a name="line396"></a>     *    preventing an automatic determination of which is more recent).&lt;/li&gt;
<a name="line397"></a>     * &lt;/ol&gt;
<a name="line398"></a>     *
<a name="line399"></a>     * (See merge() for more details)
<a name="line400"></a>     *
<a name="line401"></a>     * In the last case the merge of the non-versionable subgraph (the &quot;content&quot;)
<a name="line402"></a>     * of this node must be done by the application (for example, by providing a
<a name="line403"></a>     * merge tool for the user).
<a name="line404"></a>     *
<a name="line405"></a>     * Additionally, once the content of the nodes has been merged, their version
<a name="line406"></a>     * graph branches must also be merged. The JCR versioning system provides for
<a name="line407"></a>     * this by keeping a record, for each versionable node that fails the merge
<a name="line408"></a>     * test, of the base version of the corresponding node that caused the merge
<a name="line409"></a>     * failure. This record is kept in the jcr:mergeFailed property of this node.
<a name="line410"></a>     * After a merge, this property will contain one or more (if multiple merges
<a name="line411"></a>     * have been performed) REFERENCEs that point to the &quot;offending versions&quot;.
<a name="line412"></a>     *
<a name="line413"></a>     * To complete the merge process, the client calls doneMerge(Version v)
<a name="line414"></a>     * passing the version object referred to be the jcr:mergeFailed property
<a name="line415"></a>     * that the client wishes to connect to this node in the version graph. This
<a name="line416"></a>     * has the effect of moving the reference to the indicated version from the
<a name="line417"></a>     * jcr:mergeFailed property of this node to the jcr:predecessors.
<a name="line418"></a>     *
<a name="line419"></a>     * If the client chooses not to connect this node to a particular version
<a name="line420"></a>     * referenced in the jcr:mergeFailed property, he calls cancelMerge(String, Version).
<a name="line421"></a>     * This has the effect of removing the reference to the specified version
<a name="line422"></a>     * from jcr:mergeFailed without adding it to jcr:predecessors.
<a name="line423"></a>     *
<a name="line424"></a>     * Once the last reference in jcr:mergeFailed has been either moved to
<a name="line425"></a>     * jcr:predecessors (with doneMerge) or just removed from jcr:mergeFailed
<a name="line426"></a>     * (with cancelMerge) the jcr:mergeFailed property is automatically removed,
<a name="line427"></a>     * thus enabling this node to be checked-in, creating a new version (note
<a name="line428"></a>     * that before the jcr:mergeFailed is removed, its OnParentVersion setting of
<a name="line429"></a>     * ABORT prevents checkin). This new version will have a predecessor
<a name="line430"></a>     * connection to each version for which doneMerge was called, thus joining
<a name="line431"></a>     * those branches of the version graph.
<a name="line432"></a>     *
<a name="line433"></a>     * If successful, these changes are dispatched immediately, there is no need
<a name="line434"></a>     * to call save.
<a name="line435"></a>     *
<a name="line436"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line437"></a>     * @param \PHPCR\Version\VersionInterface $version a version referred to by the jcr:mergeFailed  property
<a name="line438"></a>     *                                                 of the node at absPath.
<a name="line439"></a>     * @return void
<a name="line440"></a>     * @throws \PHPCR\Version\VersionException if the version specified is not among those referenced in this
<a name="line441"></a>     *                                         node's jcr:mergeFailed or if the node is currently checked-in.
<a name="line442"></a>     * @throws \PHPCR\InvalidItemStateException if there are unsaved changes pending on the node at absPath.
<a name="line443"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the node at absPath is not versionable.
<a name="line444"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line445"></a>     * @api
<a name="line446"></a>     */</span>
<a name="line447"></a>    <span style="color: #000000; font-weight: bold;">function</span> doneMerge<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> \PHPCR\Version\VersionInterface <span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line448"></a>&nbsp;
<a name="line449"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line450"></a>     * Cancels the merge process with respect to the node at absPath and the
<a name="line451"></a>     * specified version.
<a name="line452"></a>     *
<a name="line453"></a>     * See doneMerge(string, Version) for a full explanation. Also see
<a name="line454"></a>     * merge(string, string, boolean) for more details.
<a name="line455"></a>     *
<a name="line456"></a>     * If successful, these changes are dispatched immediately, there is no need
<a name="line457"></a>     * to call save.
<a name="line458"></a>     *
<a name="line459"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line460"></a>     * @param \PHPCR\Version\VersionInterface $version a version referred to by the jcr:mergeFailed  property of
<a name="line461"></a>     *                                                 the node at absPath.
<a name="line462"></a>     * @return void
<a name="line463"></a>     * @throws \PHPCR\Version\VersionException if the version specified is not among those referenced in the
<a name="line464"></a>     *                                         jcr:mergeFailed  property of the node at absPath  or if the node
<a name="line465"></a>     *                                         is currently checked-in.
<a name="line466"></a>     * @throws \PHPCR\InvalidItemStateExceptionif there are unsaved changes pending on the node at absPath.
<a name="line467"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationExceptionif the node at absPath is not versionable.
<a name="line468"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line469"></a>     * @api
<a name="line470"></a>     */</span>
<a name="line471"></a>    <span style="color: #000000; font-weight: bold;">function</span> cancelMerge<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> \PHPCR\Version\VersionInterface <span style="color: #000088;">$version</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line472"></a>&nbsp;
<a name="line473"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line474"></a>     * Calling createConfiguration on the node N at absPath creates, in the
<a name="line475"></a>     * configuration storage, a new nt:configuration node whose root is N. A
<a name="line476"></a>     * reference to N is recorded in the jcr:root property of the new
<a name="line477"></a>     * configuration, and a reference to the new configuration is recorded in
<a name="line478"></a>     * the jcr:configuration property of N.
<a name="line479"></a>     *
<a name="line480"></a>     * If the specified baseline is null, a new version history is created to
<a name="line481"></a>     * store baselines of the new configuration, and the jcr:baseVersion of the
<a name="line482"></a>     * new configuration references the root of the new version history. If the
<a name="line483"></a>     * specified baseline is not null, the jcr:baseVersion of the new
<a name="line484"></a>     * configuration references the specified baseline.
<a name="line485"></a>     *
<a name="line486"></a>     * The changes are persisted immediately, a save is not required.
<a name="line487"></a>     *
<a name="line488"></a>     * @param string $absPath The absolute path to a node the prvileges shall be fetched of.
<a name="line489"></a>     * @param \PHPCR\Version\VersionInterface $baseline a Version
<a name="line490"></a>     * @return \PHPCR\NodeInterface a new nt:configuration node
<a name="line491"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if N is not versionable.
<a name="line492"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line493"></a>     * @api
<a name="line494"></a>     */</span>
<a name="line495"></a>    <span style="color: #000000; font-weight: bold;">function</span> createConfiguration<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> \PHPCR\Version\VersionInterface <span style="color: #000088;">$baseline</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line496"></a>&nbsp;
<a name="line497"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line498"></a>     * This method is called by the client to set the current activity on the
<a name="line499"></a>     * session from which this version manager has been obtained. Changing the
<a name="line500"></a>     * current activity is done by calling setActivity again. Cancelling the
<a name="line501"></a>     * current activity (so that the session has no current activity) is done
<a name="line502"></a>     * by calling setActivity(null). The activity Node is returned.
<a name="line503"></a>     *
<a name="line504"></a>     * @param \PHPCR\NodeInterface $activity an activity node
<a name="line505"></a>     * @return \PHPCR\NodeInterface the activity node
<a name="line506"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the repository does not support activities or if activity is not a nt:activity node.
<a name="line507"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line508"></a>     * @api
<a name="line509"></a>     */</span>
<a name="line510"></a>    <span style="color: #000000; font-weight: bold;">function</span> setActivity<span style="color: #009900;">&#40;</span>\PHPCR\NodeInterface <span style="color: #000088;">$activity</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line511"></a>&nbsp;
<a name="line512"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line513"></a>     * Returns the node representing the current activity or null if there is no
<a name="line514"></a>     * current activity.
<a name="line515"></a>     *
<a name="line516"></a>     * @return \PHPCR\NodeInterface An nt:activity node or null.
<a name="line517"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the repository does not support activities.
<a name="line518"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line519"></a>     * @api
<a name="line520"></a>     */</span>
<a name="line521"></a>    <span style="color: #000000; font-weight: bold;">function</span> getActivity<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line522"></a>&nbsp;
<a name="line523"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line524"></a>     * This method creates a new nt:activity at an implementation-determined
<a name="line525"></a>     * location in the /jcr:system/jcr:activities subgraph.
<a name="line526"></a>     *
<a name="line527"></a>     * The repository may, but is not required to, use the title as a hint for
<a name="line528"></a>     * what to name the new activity node. The new activity Node is returned.
<a name="line529"></a>     *
<a name="line530"></a>     * The new node is dispatched immediately and does not require a save.
<a name="line531"></a>     *
<a name="line532"></a>     * @param string $title The tilte of the activity to be created.
<a name="line533"></a>     * @return \PHPCR\NodeInterface the new activity Node.
<a name="line534"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the repository does not support activities.
<a name="line535"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line536"></a>     * @api
<a name="line537"></a>     */</span>
<a name="line538"></a>    <span style="color: #000000; font-weight: bold;">function</span> createActivity<span style="color: #009900;">&#40;</span><span style="color: #000088;">$title</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line539"></a>&nbsp;
<a name="line540"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line541"></a>     * This method removes the given $activityNode.
<a name="line542"></a>     *
<a name="line543"></a>     * The change is dispatched immediately and does not require a save.
<a name="line544"></a>     *
<a name="line545"></a>     * @param \PHPCR\NodeInterface $activityNode an activity Node
<a name="line546"></a>     * @return void
<a name="line547"></a>     * @throws \PHPCR\UnsupportedRepositoryOperationException if the repository does not support activities.
<a name="line548"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line549"></a>     * @api
<a name="line550"></a>     */</span>
<a name="line551"></a>    <span style="color: #000000; font-weight: bold;">function</span> removeActivity<span style="color: #009900;">&#40;</span>\PHPCR\NodeInterface <span style="color: #000088;">$activityNode</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line552"></a><span style="color: #009900;">&#125;</span>
<a name="line553"></a>&nbsp;</pre>
<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/version/versionmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>