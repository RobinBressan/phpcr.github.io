<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Mon, 30 May 2011 13:13:24 +0000">

<link rel="stylesheet" type="text/css" href="../../../stylesheet.css">
<link rel="start" href="../../../overview-summary.html">

<title>PHPCR/Lock/LockManagerInterface.php (PHPCR API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/lock/lockmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>PHPCR/Lock/LockManagerInterface.php</h1>
<div class="comment" id="overview_description"><p>This file is part of the PHPCR API and was originally ported from the Java
JCR API to PHP by Karsten Dambekalns for the FLOW3 project.</p><p>Copyright 2008-2011 Karsten Dambekalns <karsten@typo3.org></p><p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p><p>http://www.apache.org/licenses/LICENSE-2.0</p><p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div>

<hr>

<a name="line1"></a><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<a name="line2"></a>&nbsp;
<a name="line3"></a><span style="color: #009933; font-style: italic;">/**
<a name="line4"></a> * This file is part of the PHPCR API and was originally ported from the Java
<a name="line5"></a> * JCR API to PHP by Karsten Dambekalns for the FLOW3 project.
<a name="line6"></a> *
<a name="line7"></a> * Copyright 2008-2011 Karsten Dambekalns &lt;karsten@typo3.org&gt;
<a name="line8"></a> *
<a name="line9"></a> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<a name="line10"></a> * you may not use this file except in compliance with the License.
<a name="line11"></a> * You may obtain a copy of the License at
<a name="line12"></a> *
<a name="line13"></a> *     http://www.apache.org/licenses/LICENSE-2.0
<a name="line14"></a> *
<a name="line15"></a> * Unless required by applicable law or agreed to in writing, software
<a name="line16"></a> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<a name="line17"></a> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<a name="line18"></a> * See the License for the specific language governing permissions and
<a name="line19"></a> * limitations under the License.
<a name="line20"></a> *
<a name="line21"></a> * @license http://www.apache.org/licenses/LICENSE-2.0 Apache Software License 2.0
<a name="line22"></a> * @link http://phpcr.github.com/
<a name="line23"></a>*/</span>
<a name="line24"></a>&nbsp;
<a name="line25"></a><span style="color: #000000; font-weight: bold;">namespace</span> PHPCR\Lock<span style="color: #339933;">;</span>
<a name="line26"></a>&nbsp;
<a name="line27"></a><span style="color: #009933; font-style: italic;">/**
<a name="line28"></a> * This interface encapsulates methods for the management of locks.
<a name="line29"></a> *
<a name="line30"></a> * The \Traversable interface enables the implementation to be addressed with
<a name="line31"></a> * &lt;b&gt;foreach&lt;/b&gt;. LockManager has to implement either \IteratorAggregate or
<a name="line32"></a> * \Iterator.
<a name="line33"></a> * The iterator is equivalent to &lt;b&gt;getLockTokens()&lt;/b&gt; returning a list of all
<a name="line34"></a> * locks. The iterator keys have no significant meaning.
<a name="line35"></a> *
<a name="line36"></a> * @package phpcr
<a name="line37"></a> * @subpackage interfaces
<a name="line38"></a> * @api
<a name="line39"></a> */</span>
<a name="line40"></a><span style="color: #000000; font-weight: bold;">interface</span> LockManagerInterface <span style="color: #000000; font-weight: bold;">extends</span> \Traversable
<a name="line41"></a><span style="color: #009900;">&#123;</span>
<a name="line42"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line43"></a>     * Adds the specified lock token to the current Session.
<a name="line44"></a>     *
<a name="line45"></a>     * Holding a lock token makes the current Session the owner of the lock
<a name="line46"></a>     * specified by that particular lock token.
<a name="line47"></a>     *
<a name="line48"></a>     * @param string $lockToken A lock token (a string).
<a name="line49"></a>     * @return void
<a name="line50"></a>     *
<a name="line51"></a>     * @throws \PHPCR\Lock\LockException if the specified lock token is already held by another Session and the
<a name="line52"></a>     *                                   implementation does not support simultaneous ownership of open-scoped locks.
<a name="line53"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line54"></a>     * @api
<a name="line55"></a>     */</span>
<a name="line56"></a>    <span style="color: #000000; font-weight: bold;">function</span> addLockToken<span style="color: #009900;">&#40;</span><span style="color: #000088;">$lockToken</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line57"></a>&nbsp;
<a name="line58"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line59"></a>     * Returns the Lock object that applies to the node at the specified absPath.
<a name="line60"></a>     *
<a name="line61"></a>     * This may be either a lock on that node itself or a deep lock on a node
<a name="line62"></a>     * above that node.
<a name="line63"></a>     *
<a name="line64"></a>     * @param string $absPath - absolute path of node for which to obtain the lock
<a name="line65"></a>     * @return \PHPCR\Lock\LockInterface The applicable Lock object.
<a name="line66"></a>     *
<a name="line67"></a>     * @throws \PHPCR\Lock\LockException if no lock applies to this node.
<a name="line68"></a>     * @throws \PHPCR\AccessDeniedException if the current session does not have sufficient access to get the lock.
<a name="line69"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line70"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line71"></a>     * @api
<a name="line72"></a>     */</span>
<a name="line73"></a>    <span style="color: #000000; font-weight: bold;">function</span> getLock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line74"></a>&nbsp;
<a name="line75"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line76"></a>     * Gets the list of previously registered tokens.
<a name="line77"></a>     *
<a name="line78"></a>     * Returns an array containing all lock tokens currently held by the current
<a name="line79"></a>     * Session. Note that any such tokens will represent open-scoped locks, since
<a name="line80"></a>     * session-scoped locks do not have tokens.
<a name="line81"></a>     *
<a name="line82"></a>     * @return array an array of lock tokens (strings)
<a name="line83"></a>     *
<a name="line84"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line85"></a>     * @api
<a name="line86"></a>     */</span>
<a name="line87"></a>    <span style="color: #000000; font-weight: bold;">function</span> getLockTokens<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line88"></a>&nbsp;
<a name="line89"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line90"></a>     * Determines if the node identified by the passed path holds a lock.
<a name="line91"></a>     *
<a name="line92"></a>     * Returns true if the node at absPath holds a lock; otherwise returns false.
<a name="line93"></a>     * To hold a lock means that this node has actually had a lock placed on it
<a name="line94"></a>     * specifically, as opposed to just having a lock apply to it due to a deep
<a name="line95"></a>     * lock held by a node above.
<a name="line96"></a>     *
<a name="line97"></a>     * @param string $absPath The absolute path of node to be checked.
<a name="line98"></a>     * @return boolean True, if the node identified by the given path holds a lock, else false.
<a name="line99"></a>     *
<a name="line100"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line101"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line102"></a>     * @api
<a name="line103"></a>     */</span>
<a name="line104"></a>    <span style="color: #000000; font-weight: bold;">function</span> holdsLock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line105"></a>&nbsp;
<a name="line106"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line107"></a>     * Places a lock on the node at absPath.
<a name="line108"></a>     *
<a name="line109"></a>     * If successful, the node is said to hold the lock.
<a name="line110"></a>     *
<a name="line111"></a>     * If &lt;b&gt;isDeep&lt;/b&gt; is true then the lock applies to the specified node and all its
<a name="line112"></a>     * descendant nodes; if false, the lock applies only to the specified node.
<a name="line113"></a>     * On a successful lock, the jcr:lockIsDeep property of the locked node is
<a name="line114"></a>     * set to this value.
<a name="line115"></a>     *
<a name="line116"></a>     * If &lt;b&gt;isSessionScoped&lt;/b&gt; is true then this lock will expire upon the expiration
<a name="line117"></a>     * of the current session (either through an automatic or explicit Session.logout);
<a name="line118"></a>     * if false, this lock does not expire until it is explicitly unlocked, it
<a name="line119"></a>     * times out, or it is automatically unlocked due to a implementation-specific
<a name="line120"></a>     * limitation.
<a name="line121"></a>     *
<a name="line122"></a>     * The &lt;b&gt;timeout&lt;/b&gt; parameter specifies the number of seconds until the lock times
<a name="line123"></a>     * out (if it is not refreshed with Lock.refresh in the meantime). An
<a name="line124"></a>     * implementation may use this information as a hint or ignore it altogether.
<a name="line125"></a>     * Clients can discover the actual timeout by inspecting the returned Lock
<a name="line126"></a>     * object.
<a name="line127"></a>     *
<a name="line128"></a>     * The &lt;b&gt;ownerInfo&lt;/b&gt; parameter can be used to pass a string holding owner
<a name="line129"></a>     * information relevant to the client. An implementation may either use or
<a name="line130"></a>     * ignore this parameter. If it uses the parameter it must set the jcr:lockOwner
<a name="line131"></a>     * property of the locked node to this value and return this value on
<a name="line132"></a>     * Lock.getLockOwner. If it ignores this parameter the jcr:lockOwner property
<a name="line133"></a>     * (and the value returned by Lock.getLockOwner) is set to either the value
<a name="line134"></a>     * returned by Session.getUserID of the owning session or an implementation-
<a name="line135"></a>     * specific string identifying the owner.
<a name="line136"></a>     *
<a name="line137"></a>     * The method returns a Lock object representing the new lock. If the lock is
<a name="line138"></a>     * open-scoped the returned lock will include a lock token. The lock token is
<a name="line139"></a>     * also automatically added to the set of lock tokens held by the current session.
<a name="line140"></a>     *
<a name="line141"></a>     * The addition or change of the properties jcr:lockIsDeep and jcr:lockOwner
<a name="line142"></a>     * are persisted immediately; there is no need to call save.
<a name="line143"></a>     *
<a name="line144"></a>     * It is possible to lock a node even if it is checked-in.
<a name="line145"></a>     *
<a name="line146"></a>     * @param string $absPath The absolute path of node to be locked
<a name="line147"></a>     * @param boolean $isDeep If true this lock will apply to this node and all its descendants;
<a name="line148"></a>     *                        if false, it applies only to this node.
<a name="line149"></a>     * @param boolean $isSessionScoped If true, this lock expires with the current session;
<a name="line150"></a>     *                                 if false it expires when explicitly or automatically unlocked for
<a name="line151"></a>     *                                 some other reason.
<a name="line152"></a>     * @param integer $timeoutHint Desired lock timeout in seconds (servers are free to ignore this value);
<a name="line153"></a>     *                             specify Long.MAX_VALUE for no timeout.
<a name="line154"></a>     * @param string $ownerInfo A string containing owner information supplied by the client; servers are
<a name="line155"></a>     *                          free to ignore this value.
<a name="line156"></a>     * @return \PHPCR\Lock\LockInterface A Lock object containing a lock token.
<a name="line157"></a>     *
<a name="line158"></a>     * @throws \PHPCR\Lock\LockException if this node is not mix:lockable or this node is already locked or isDeep
<a name="line159"></a>     *                                   is true and a descendant node of this node already holds a lock.
<a name="line160"></a>     * @throws \PHPCR\AccessDeniedException if this session does not have sufficient access to lock this node.
<a name="line161"></a>     * @throws \PHPCR\InvalidItemStateException if this node has pending unsaved changes.
<a name="line162"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line163"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line164"></a>     * @api
<a name="line165"></a>     */</span>
<a name="line166"></a>    <span style="color: #000000; font-weight: bold;">function</span> lock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #339933;">,</span> <span style="color: #000088;">$isDeep</span><span style="color: #339933;">,</span> <span style="color: #000088;">$isSessionScoped</span><span style="color: #339933;">,</span> <span style="color: #000088;">$timeoutHint</span><span style="color: #339933;">,</span> <span style="color: #000088;">$ownerInfo</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line167"></a>&nbsp;
<a name="line168"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line169"></a>     * Determines if the node at absPath is locked.
<a name="line170"></a>     *
<a name="line171"></a>     * Returns true if the node at absPath is locked either as a result of a lock
<a name="line172"></a>     * held by that node or by a deep lock on a node above that node; otherwise
<a name="line173"></a>     * returns false.
<a name="line174"></a>     *
<a name="line175"></a>     * @param string $absPath The absolute path of a node to be checked.
<a name="line176"></a>     * @return boolean True, if the identified node has a lock.
<a name="line177"></a>     *
<a name="line178"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath.
<a name="line179"></a>     * @throws \PHPCR\RepositoryException if an error occurs.
<a name="line180"></a>     * @api
<a name="line181"></a>     */</span>
<a name="line182"></a>    <span style="color: #000000; font-weight: bold;">function</span> isLocked<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line183"></a>&nbsp;
<a name="line184"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line185"></a>     * Removes the specified lock token from this Session.
<a name="line186"></a>     *
<a name="line187"></a>     * @param string $lockToken - a lock token (a string)
<a name="line188"></a>     * @return void
<a name="line189"></a>     *
<a name="line190"></a>     * @throws \PHPCR\Lock\LockException if the current Session does not hold the specified lock token.
<a name="line191"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line192"></a>     * @api
<a name="line193"></a>     */</span>
<a name="line194"></a>    <span style="color: #000000; font-weight: bold;">function</span> removeLockToken<span style="color: #009900;">&#40;</span><span style="color: #000088;">$lockToken</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line195"></a>&nbsp;
<a name="line196"></a>    <span style="color: #009933; font-style: italic;">/**
<a name="line197"></a>     * Removes the lock on the node at absPath.
<a name="line198"></a>     *
<a name="line199"></a>     * Also removes the properties jcr:lockOwner and jcr:lockIsDeep from that node.
<a name="line200"></a>     * As well, the corresponding lock token is removed from the set of lock tokens
<a name="line201"></a>     * held by the current Session.
<a name="line202"></a>     *
<a name="line203"></a>     * If the node does not currently hold a lock or holds a lock for which this
<a name="line204"></a>     * Session is not the owner and is not a &quot;lock-superuser&quot;, then a
<a name="line205"></a>     * \PHPCR\Lock\LockException is thrown.
<a name="line206"></a>     *
<a name="line207"></a>     * &lt;b&gt;Note:&lt;/b&gt;
<a name="line208"></a>     * However that the system may give permission to a non-owning session
<a name="line209"></a>     * to unlock a lock. Typically such &quot;lock-superuser&quot; capability is intended
<a name="line210"></a>     * to facilitate administrational clean-up of orphaned open-scoped locks.
<a name="line211"></a>     *
<a name="line212"></a>     * Note that it is possible to unlock a node even if it is checked-in (the
<a name="line213"></a>     * lock-related properties will be changed despite the checked-in status).
<a name="line214"></a>     *
<a name="line215"></a>     * @param string $absPath The absolute path of node to be unlocked.
<a name="line216"></a>     * @return void
<a name="line217"></a>     *
<a name="line218"></a>     * @throws \PHPCR\Lock\LockException If this node does not currently hold a lock or holds a lock for which
<a name="line219"></a>     *                                   this Session does not have the correct lock token.
<a name="line220"></a>     * @throws \PHPCR\AccessDeniedException if the current session does not have permission to unlock this node.
<a name="line221"></a>     * @throws \PHPCR\InvalidItemStateException if this node has pending unsaved changes.
<a name="line222"></a>     * @throws \PHPCR\PathNotFoundException if no node is found at $absPath
<a name="line223"></a>     * @throws \PHPCR\RepositoryException if another error occurs.
<a name="line224"></a>     * @api
<a name="line225"></a>     */</span>
<a name="line226"></a>    <span style="color: #000000; font-weight: bold;">function</span> unlock<span style="color: #009900;">&#40;</span><span style="color: #000088;">$absPath</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a name="line227"></a><span style="color: #009900;">&#125;</span>
<a name="line228"></a>&nbsp;</pre>
<div class="header">
<h1>PHPCR</h1>
<ul>
<li><a href="../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../overview-files.html">Files</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../todo-list.html">Todo</a></li>
<li><a href="../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../index.html" target="_top">Frames</a>
<a href="../../../source/phpcr/lock/lockmanagerinterface.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>